import{d as C,l as $,aa as A,r as p,m as J,o as u,c as _,w as o,e as t,a3 as j,j as z,F as w,s as c,b as n,I as D,aE as N,Q as l,aF as x,al as T,aG as U,R as V,aH as K,an as R,O as W,D as B,ad as L,y as r}from"./vendor.60359f7c.js";import{_ as G,s as E}from"./StreamSaver.55f74170.js";import{i as H}from"./index.271ce602.js";const M={class:"share-info-page"},Y={key:0,class:"share-file-box",style:{height:"100vh"}},Q=r("\u53BB\u9996\u9875"),q={key:1,class:"share-password"},X=w("a",{href:"https://mypikpak.com/",target:"_blank",class:"logo-box"},[w("img",{src:"https://www.mypikpak.com/logo.png",class:"logo-box__icon",alt:""}),w("div",{class:"logo-box__text"},"PikPak")],-1),Z=r("\u63D0\u53D6\u6587\u4EF6"),ee=r("\u6253\u5F00PotPlayer"),ae=r("\u4FDD\u5B58\u5230\u7F51\u76D8"),oe=r("\u4E0B\u8F7D"),te={key:0,style:{width:"100%",height:"100%"}},ne={key:1,class:"share-file-box"},ie=["src"],se=r("\u7ACB\u5373\u4E0B\u8F7D"),ce=C({setup(ue){const S=$(),v=A(()=>S.params.id),a=p({needPassword:!0}),f=p(!1),d=p(),h=p(!1),m=()=>{const i=JSON.parse(window.localStorage.getItem("pikpakShare-"+v.value)||"{}");if(i&&i.Name)return a.value=i,new Promise(e=>e(i));f.value=!0,z.get("https://pikpak-depot.z10.workers.dev",{params:{page_id:v.value,password:d.value||void 0}}).then(e=>{e.data.needPassword=e.data.needPassword||!1,e.data.needPassword&&d.value&&window.$message.error("\u63D0\u53D6\u7801\u9519\u8BEF"),e.data.info&&JSON.parse(e.data.info)&&(e.data.info=JSON.parse(e.data.info)),e.data.info2&&JSON.parse(e.data.info2)&&(e.data.info=Object.assign(e.data.info,JSON.parse(e.data.info2)),delete e.data.info2),e.data.info3&&JSON.parse(e.data.info3)&&(e.data.info=Object.assign(e.data.info,JSON.parse(e.data.info3)),delete e.data.info3),a.value=e.data,!a.value.needPassword&&a.value.Name&&window.localStorage.setItem("pikpakShare-"+v.value,JSON.stringify(a.value))}).catch(e=>{window.$message.error(e.response.data.error),h.value=!0}).finally(()=>{f.value=!1})},k=()=>{E.mitm="mitm.html";const i=E.createWriteStream(a.value.info.name);fetch(a.value.info.web_content_link).then(e=>{window.$downId||(window.$downId=[]),window.$downId.push(a.value.info.id);const s=e.body;if(window.WritableStream&&(s==null?void 0:s.pipeTo))return s.pipeTo(i).then(()=>{window.$downId.splice(window.$downId.indexOf(a.value.info.id),1)});const y=i.getWriter(),P=e.body.getReader(),F=()=>P.read().then(g=>{g.done?y.close():y.write(g.value).then(F)});F()})},O=()=>{let i={kind:"drive#file",name:a.value.info.name,size:a.value.info.size,hash:a.value.info.hash,upload_type:"UPLOAD_TYPE_RESUMABLE",objProvider:{provider:"UPLOAD_TYPE_UNKNOWN"}};H.post("https://api-drive.mypikpak.com/drive/v1/files",i).then(e=>{window.$message.success("\u6DFB\u52A0\u6210\u529F")})},b=()=>{window.open("potplayer://"+a.value.info.web_content_link)},I=()=>{window.location.href="./"};return J(()=>{m(),window.onbeforeunload=function(i){return!window.$downId||window.$downId.length===0?null:(i=i||window.event,i&&(i.returnValue="\u8FD8\u6709\u5F85\u4E0B\u8F7D\u6587\u4EF6"),"\u8FD8\u6709\u5F85\u4E0B\u8F7D\u6587\u4EF6?")}}),(i,e)=>(u(),_(t(j),{show:f.value&&!d.value,description:"\u83B7\u53D6\u4E2D"},{default:o(()=>[w("div",M,[h.value?(u(),c("div",Y,[n(t(x),{description:"\u5206\u4EAB\u94FE\u63A5\u9519\u8BEF\u6216\u5DF2\u5931\u6548"},{icon:o(()=>[n(t(D),null,{default:o(()=>[n(t(N))]),_:1})]),extra:o(()=>[n(t(l),{size:"small",onClick:I},{default:o(()=>[Q]),_:1})]),_:1})])):a.value.needPassword?(u(),c("div",q,[X,n(t(R),{class:"password-form"},{default:o(()=>[n(t(T),{label:"\u8BF7\u8F93\u5165\u63D0\u53D6\u7801"},{default:o(()=>[n(t(U),null,{default:o(()=>[n(t(V),{value:d.value,"onUpdate:value":e[0]||(e[0]=s=>d.value=s),type:"password","show-password-on":"mousedown",onKeyup:K(m,["enter"]),placeholder:"\u8BF7\u8F93\u5165\u63D0\u53D6\u7801"},null,8,["value","onKeyup"]),n(t(l),{type:"primary",loading:f.value&&d.value,onClick:m},{default:o(()=>[Z]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})])):a.value.info?(u(),_(t(W),{key:2,style:{width:"100vw",height:"100vh"},title:a.value.info.name},{"header-extra":o(()=>[n(t(L),null,{default:o(()=>[a.value.info.mime_type.indexOf("video")!==-1?(u(),_(t(l),{key:0,onClick:b},{default:o(()=>[ee]),_:1})):B("",!0),n(t(l),{onClick:O},{default:o(()=>[ae]),_:1}),n(t(l),{onClick:k},{default:o(()=>[oe]),_:1})]),_:1})]),default:o(()=>{var s;return[a.value.info.mime_type.indexOf("video")!==-1||a.value.info.mime_type.indexOf("audio")!==-1?(u(),c("div",te,[n(G,{video:a.value.info},null,8,["video"])])):(u(),c("div",ne,[a.value.info.mime_type.indexOf("image")!==-1?(u(),c("img",{key:0,src:(s=a.value.info)==null?void 0:s.web_content_link,style:{"max-width":"100%","max-height":"100%"}},null,8,ie)):(u(),_(t(x),{key:1,description:"\u5F53\u524D\u6587\u4EF6\u4E0D\u652F\u6301\u9884\u89C8"},{icon:o(()=>[n(t(D),null,{default:o(()=>[n(t(N))]),_:1})]),extra:o(()=>[n(t(l),{size:"small",onClick:k},{default:o(()=>[se]),_:1})]),_:1}))]))]}),_:1},8,["title"])):B("",!0)])]),_:1},8,["show"]))}});export{ce as default};
